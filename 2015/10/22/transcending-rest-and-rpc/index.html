<!DOCTYPE html> <!--[if IE 8]> <html lang="en" class="ie8"> <![endif]--> <!--[if IE 9]> <html lang="en" class="ie9"> <![endif]--> <!--[if !IE]><!--> <html lang="en"> <!--<![endif]--> <head> <title>Transcending REST and RPC | Codurance </title> <!-- Meta --> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content="Our team of dedicated software craftsmen provides consultancy, software development, and training services to clients seeking high quality development processes and software solutions."> <meta name="author" content="Codurance Ltd"> <!-- Open Graph tags - Used when publishing on Facebook --> <meta property="og:site_name" content="Codurance"/> <meta property="og:description" content="Our team of dedicated software craftsmen provides consultancy, software development, and training services to clients seeking high quality development processes and software solutions."/> <meta property="og:url" content="http://codurance.com"/> <meta property="og:image" content="http://codurance.com/assets/img/codurance.png"/> <!-- Favicon --> <link rel="shortcut icon" href="/assets/img/favicon.ico"> <!-- CSS Global Compulsory --> <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css"> <link rel="stylesheet" href="/assets/css/style.css"> <!-- CSS Implementing Plugins --> <link rel="stylesheet" href="/assets/plugins/line-icons/line-icons.css"> <link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.min.css"> <link rel="stylesheet" href="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.css"> <!-- CSS Theme --> <link rel="stylesheet" href="/assets/css/plugins.css"> <link rel="stylesheet" href="/assets/css/app.css"> <link rel="stylesheet" href="/assets/css/pages/blog.css"> <link rel="stylesheet" href="/assets/css/theme-colors/orange.css"> <link rel="stylesheet" href="/assets/css/headers/header-default.css"> <link rel="stylesheet" href="/assets/css/footers/footer-v1.css"> <!-- CSS Customization --> <link rel="stylesheet" href="/assets/css/custom.css"> <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/idea.min.css"> <!--fonts --> <link href='http://fonts.googleapis.com/css?family=Oxygen:700,400' rel='stylesheet' type='text/css'> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-46289079-1', 'codurance.com'); ga('send', 'pageview'); </script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script> <!-- ShareThis --> <script type="text/javascript">var switchTo5x=true;</script> <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script> <script type="text/javascript" src="http://s.sharethis.com/loader.js"></script> </head> <body > <div class="wrapper"> <!--=== Header ===--> <div class="header no-topbar"> <div class="container"> <!-- Logo --> <a class="logo" href="/"> <img class="logo-header" src="/assets/img/codurance.png" alt="Codurance Logo" height="45px;"> </a> <!-- End Logo --> <!-- Toggle get grouped for better mobile display --> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse"> <span class="sr-only">Toggle navigation</span> <span class="fa fa-bars"></span> </button> <!-- End Toggle --> </div><!--/end container--> <!-- Collect the nav links, forms, and other content for toggling --> <div class="collapse navbar-collapse mega-menu navbar-responsive-collapse"> <div class="container"> <ul class="nav navbar-nav"> <li><a href="/services">Services</a></li> <li><a href="/videos">Videos</a></li> <li><a href="/blog">Blog</a></li> <li><a href="/work-with-us">Work with us</a></li> <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown">About Us <i class="icon-angle-down">&nbsp;</i></a><ul class="dropdown-menu"> <li><a href="/aboutus/ourteam">Our Team</a></li> <li><a href="/aboutus/ourcompany">Our Company</a></li> <li><a href="/aboutus/ourpractices">Our Practices</a></li> <li><a href="/aboutus/contact">Contact</a></li> </ul></li> </ul> </div><!--/end container--> </div><!--/navbar-collapse--> </div> <!--=== End Header ===--> <div class="container content"> <div class="row blog-page blog-item"> <!-- Left Sidebar --> <div class="col-md-9 md-margin-bottom-60"> <!--Blog Post--> <div class="blog margin-bottom-40"> <h1>Transcending REST and RPC</h1> <div class="blog-post-tags"> <ul class="list-unstyled list-inline blog-info"> <li><i class="fa fa-calendar"></i> 22 Oct 2015</li> <li><i class="fa fa-pencil"></i> Felipe Fernandez</li> </ul> <ul class="list-unstyled list-inline blog-tags"> <li> <a href="/blog/tag/rest/"><i class="fa fa-tags"></i> rest </a> <a href="/blog/tag/rpc/"><i class="fa fa-tags"></i> rpc </a> <a href="/blog/tag/microservices/"><i class="fa fa-tags"></i> microservices </a> </li> </ul> </div> <p>It seems that a new paradigm is coming. Facebook and Netflix have come up with different implementations for that idea. Some people are calling it <a href="http://www.infoq.com/presentations/domain-driven-architecture">Demand-Driven Architecture</a>, but before I show you some solutions, let's go over some history to understand the problem. I will use the example that Netflix provides, but I think that most of us will find the patterns familiar.</p> <p>Just for clarity, let's assume that we have an on-demand streaming service -- quite similar to Netflix :) -- that has three microservices. One contains the genres, another one the titles and the last one contains the ratings that different users give to those titles. As we're in 2015 we'll discard RPC as architectural style and we'll go with a RESTful design. Let's briefly enumerate the characteristics of a RESTful design:</p> <ul> <li>HTTP verbs have direct correspondence with CRUD verbs. One of the benefits is that clients can understand what is going on the server without digging into the implementation. For instance, we know that PUT is idempotent, so as there will not be any side effect, the client can call to that endpoint several times in a row without any issue.</li> <li>We use extensive HTTP caching. Through headers like Cache-Control or ETag, we leverage one of the most juicy features of HTTP: caching resources.</li> <li>HATEOAS for the win. Every single representation should have links to different representations so the clients can navigate through our backend like a graph.</li> </ul> <p><a href="http://www.restapitutorial.com/">Further reading</a></p> <h2>REST limitations</h2> <p>Let's imagine that we send a GET to the genres endpoint. The response will include links to other GET requests like titles/1234 or ratings/6789. If we have the title "Titanic" in different genres (romance, drama and DiCaprioRules) you can see how the client is going to do at least two redundant requests. Apart from that the client is going to reshape the data whenever it comes back since it's likely that the client won't need every single field that those responses include. So, we have two problems with this design:</p> <ul> <li>High latency as we don't optimize calls.</li> <li>Large message sizes.</li> </ul> <h2>Patching REST with RPC</h2> <p>One way of overcoming these problems is customising our requests with query params. You can say to the server something like "<em>give me only a couple of the fields that you expose on that representation</em>"" or whatever arbitrary parameter. That means that you'll lose the caching that HTTP offers as now you'll have a ton of possible <em>not-really-resources</em> to cache.</p> <p>Also you can create new abstractions ad-hoc that aggregate that for the client. In fact one of the benefits of CQRS is being able to create different views of your internal entities, so the demands of the client doesn't affect your domain modeling. That has a problem though: there is a big a coupling with the server. Our system has a massive amount of fragmentation as you can stream over Android, iOS, TVs and also, different versions of the same client device. Therefore there are going to be different needs and rhythms and the coordination between backend and clients is going to be really messy.</p> <p>Also, CQRS is amazing in the fact that you could decide to model your system around different bounded contexts, i.e, different CQRS deployables. If your client needs a view that aggregate data from two CQRS units, you have the same problem.</p> <h2>Demand driven architecture to the rescue</h2> <p>This leads to the point of Demand Driven Architectures. Conceptually the backend is just a single entity and, since it's modeled using REST principles, it's defining what is the shape of the data. However, we're going to have tons of clients with different needs and all of them need to twist themselves in order to get the shape of the data that they want. Would it be great if clients could just send queries to the logical data unit called backend?</p> <p>If we think in a relational database the concept is similar. We have different tables (rest endpoints, resources, backend services) and we have a query language that allows us to join and shape the data easily. Some of the optimizations of that query will be done by the platform that runs those queries.</p> <h2>Falcor and JSON Graph</h2> <p>Netflix has created a tool called <a href="http://netflix.github.io/falcor">Falcor</a> that tries to solve this concrete problem. Clients won't talk with the backend services directly anymore, instead of they will send queries to a Falcor service that will do the routing, aggregations, projections and optimizations. This is an image from Falcor's official documentation.</p> <p><img src="/assets/img/custom/blog/falcor-network-diagram.png" /></p> <p>They based that platform on the idea of JSON Graph. Let me explain it briefly. JSON is in essence a tree structure. However, most of our data has relationships so it should be modeled like a graph. Using REST design programmers usually solve that problem through ids, but that makes our life really difficult (think about problems like cache invalidation). As they say:</p> <blockquote><p>JSON Graph is valid JSON and can be parsed by any JSON parser. However JSON Graph introduces new primitive types to JSON to allow JSON to be used to represent graph information in a simple and consistent way.</p></blockquote> <p>They borrow the idea from unix filesystem. That filesystem is a tree, but thanks to symlinks you can emulate the behaviour of a graph. That has massive implications in the way that Falcor optimises calls to backend services. Instead of keeping some values in a denormalised fashion, Falcor keeps references to that normalised value, so, if you ask for a value that has been already retrieved, Falcor will avoid that call. Also That makes cache invalidation much easier.</p> <p><img src="/assets/img/custom/blog/falcor-services-diagram.png" /></p> <p>As you can see in the example, we don't store denormalised documents for titles inside of genres, but a reference through a titles map indexed by id. I can show you some code that I've been working on for a proof of concept. Falcor server side is currently only available on Node.js but <a href="https://twitter.com/falcorjs/status/575657256475189248">there are plans to porting it into another platforms</a>.</p><pre><code>router.get('/model.json', falcorKoa.dataSourceRoute(new FalcorRouter([
        {
            route: "teamsById[{integers:teamIds}]['name', 'memberCount']",
            get  : function(pathSet) {
                const teamIds = pathSet.teamIds;
                const keys = pathSet[2];
                return teamsService.getTeams()
                        .then(function(teams) {
                            var results = [];
                            teamIds.forEach(function(teamId) {
                                keys.forEach(function(key) {
                                    var team = teams[teamId];
                                    results.push({
                                        path : ['team', teamId, key],
                                        value: team[key]
                                    });
                                });
                            });
                            return results;
                        });
            }
        }
    ])));
</code></pre><p>The client side would look like this:</p><pre><code>const model = new falcor.Model({ source: new falcor.HttpDataSource('/model.json') });
model.get('teamsById['1234', '456'].name');
model.get('teamsById['789']['name', 'memberCount']');
</code></pre><h2>IN CONCLUSION</h2> <p>There are no silver bullets in software and nobody is claiming than Falcor or GraphQL are going to solve every single problem with client/server integration. However, if you have an application with a lot of clients and your backend has a complex data model, it might be worth giving this new paradigm a try.</p> <ul> <li><a href="http://netflix.github.io/falcor">Falcor</a></li> <li><a href="https://facebook.github.io/react/blog/2015/05/01/graphql-introduction.html">GraphQL</a></li> <li><a href="http://www.infoq.com/presentations/domain-driven-architecture">Demand-Driven Architecture</a></li> </ul> </div> <!--End Blog Post--> <!--About the author--> <!--End About the author--> </div> <!-- End Left Sidebar --> <!-- Right Sidebar --> <div class="col-md-3"> <!--Related Blog Posts--> <div class="posts margin-bottom-40"> <div class="headline headline-md"> <h2>Related Blogs</h2> </div> <!--End Related Blog Posts--> </div> <!-- Recent blogs --> <div class="posts margin-bottom-40"> <div class="headline headline-md"><h2>Recent Blogs</h2></div> <dl class="dl-horizontal"> <dt><a href="/2016/01/10/clojure-vim-environment/"><img src="/assets/img/custom/blog/vimenv.png" alt=""></a></dt> <dd> <p><a href="/2016/01/10/clojure-vim-environment/">Clojure VIM Environment</a></p> </dd> </dl> <dl class="dl-horizontal"> <dt><a href="/2015/12/13/testing-multithreaded-code-in-java/"><img src="/assets/img/custom/blog/picot.png" alt=""></a></dt> <dd> <p><a href="/2015/12/13/testing-multithreaded-code-in-java/">Testing multithreaded code in Java</a></p> </dd> </dl> <dl class="dl-horizontal"> <dt><a href="/2015/11/25/mouseless-programming/"><img src="/assets/img/custom/blog/dilbert.jpg" alt=""></a></dt> <dd> <p><a href="/2015/11/25/mouseless-programming/">Mouseless Programming</a></p> </dd> </dl> <dl class="dl-horizontal"> <dt><a href="/2015/11/25/Property-based-testing-FsCheck-Resharper-NCrunch-Visual-Studio-2013/"><img src="/assets/img/custom/blog/2015-12-01-Faran-crane-truck.jpg" alt=""></a></dt> <dd> <p><a href="/2015/11/25/Property-based-testing-FsCheck-Resharper-NCrunch-Visual-Studio-2013/">Property based testing with FsCheck, Resharper and NCrunch in Visual Studio 2013</a></p> </dd> </dl> <dl class="dl-horizontal"> <dt><a href="/2015/11/22/changing-scalatra-and-sbt-directories/"><img src="/assets/img/custom/blog/2015-11-21-folders-small.jpg" alt=""></a></dt> <dd> <p><a href="/2015/11/22/changing-scalatra-and-sbt-directories/">Changing Scalatra and sbt default directories</a></p> </dd> </dl> <dl class="dl-horizontal"> <dt><a href="/2015/11/22/my-first-couple-of-months-at-codurance/"><img src="/assets/img/custom/blog/Five Characteristics of a Great Company Culture.jpg" alt=""></a></dt> <dd> <p><a href="/2015/11/22/my-first-couple-of-months-at-codurance/">My first couple of months at Codurance</a></p> </dd> </dl> <dl class="dl-horizontal"> <dt><a href="/2015/11/19/configuring-an-enterprise-app-sucks/"><img src="/assets/img/custom/blog/2015-11-19-configuring-an-enterprise-app-sucks/space-shuttle.jpg" alt=""></a></dt> <dd> <p><a href="/2015/11/19/configuring-an-enterprise-app-sucks/">Configuring an enterprise app sucks</a></p> </dd> </dl> <!-- End Recent blogs --> </div> <!-- End Right Sidebar --> </div> <!--/row--> </div> <!--/container--> </div> <!-- Sharethis toolbar. Note this will not work in a local environment --> <script type="text/javascript">stLight.options({publisher: "8b795ed1-9577-43d1-9e4e-55c54306336b", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script> <script> var options={ "publisher": "8b795ed1-9577-43d1-9e4e-55c54306336b", "position": "left", "ad": { "visible": false, "openDelay": 5, "closeDelay": 0}, "chicklets": { "items": ["twitter", "linkedin", "googleplus", "facebook", "email"]}}; var st_hover_widget = new sharethis.widgets.hoverbuttons(options); </script> <!-- End Sharethis toolbar --> <!--=== Copyright ===--> <!--=== Footer ===--> <div id="footer-v1" class="footer-v1"> <div class="footer"> <div class="container"> <div class="row"> <!-- About --> <div class="col-md-3 md-margin-bottom-40"> <a href="/"> <img id="logo-footer" class="footer-logo" src="/assets/img/footer-logo.png" alt="Codurance"> </a> <p>Software is our passion. </p> <p>We are software craftsmen. We build well-crafted software for our customers, we help developers to get better at their craft through training, coaching and mentoring, and we help companies get better at delivering software. </p> </div><!--/col-md-3--> <!-- End About --> <!-- Latest --> <div class="col-md-3 md-margin-bottom-40"> <div class="posts"> <div class="headline"><h2>Latest Blogs</h2></div> <ul class="list-unstyled latest-list"> <li> <a href="/2016/01/10/clojure-vim-environment/" alt="Clojure VIM Environment">Clojure VIM Environment</a> <small>Mashooq Badar</small> </li> <li> <a href="/2015/12/13/testing-multithreaded-code-in-java/" alt="Testing multithreaded code in Java">Testing multithreaded code in Java...</a> <small>Felipe Fernández</small> </li> <li> <a href="/2015/11/25/mouseless-programming/" alt="Mouseless Programming">Mouseless Programming</a> <small>Tomaz Tekavec</small> </li> </ul> </div> </div><!--/col-md-3--> <!-- End Latest --> <!-- Link List --> <div class="col-md-3 md-margin-bottom-40"> <div class="headline"><h2>Useful Links</h2></div> <ul class="list-unstyled link-list"> <li><a href="/services">Services</a><i class="fa fa-angle-right"></i></li> <li><a href="/videos">Videos</a><i class="fa fa-angle-right"></i></li> <li><a href="/blog">Blog</a><i class="fa fa-angle-right"></i></li> <li><a href="/work-with-us">Work with us</a><i class="fa fa-angle-right"></i></li> <li><a href="/aboutus/ourcompany">About us</a><i class="fa fa-angle-right"></i></li> </ul> </div><!--/col-md-3--> <!-- End Link List --> <!-- Contact Us --> <div class="col-md-3 map-img md-margin-bottom-40"> <div class="headline"><h2>Contact Us</h2></div> <address class="md-margin-bottom-40"> <a href="https://www.google.co.uk/maps/place/I2+Office+Aldersgate/@51.5175798,-0.0978509,19z/data=!4m2!3m1!1s0x0000000000000000:0x71133b028b4f269d" target="_blank">200 Aldersgate, EC1A 4HD<br> London, UK </a><br> Phone: +44 203 440 4015 <br> Email: <a href="mailto:hello@codurance.com" target="_blank" class="">hello@codurance.com</a> </address> </div><!--/col-md-3--> <!-- End Contact Us --> </div> </div> </div><!--/footer--> <div class="copyright"> <div class="container"> <div class="row"> <div class="col-md-6"> <p> Company Registration No: 8712584 </p> </div> <!-- Social Links --> <div class="col-md-6"> <ul class="footer-socials list-inline"> <li> <a href="https://www.facebook.com/codurance/" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Facebook" target="_blank"> <i class="fa fa-facebook"></i> </a> </li> <li> <a href="https://www.linkedin.com/company/codurance" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Linkedin" target="_blank"> <i class="fa fa-linkedin"></i> </a> </li> <li> <a href="https://twitter.com/codurance" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Twitter" target="_blank"> <i class="fa fa-twitter"></i> </a> </li> <li> <a href="/atom.xml" data-original-title="Feed" class="tooltips" data-toggle="tooltip" data-placement="top" title="" target="_blank"> <i class="fa fa-rss"></i> </a> </li> </ul> </div> <!-- End Social Links --> </div> </div> </div><!--/copyright--> </div> <!--=== End Footer ===--> <!--=== End Copyright ===--> </div> <!-- JS Global Compulsory --> <script type="text/javascript" src="/assets/plugins/jquery/jquery.min.js"></script> <script type="text/javascript" src="/assets/plugins/jquery/jquery-migrate.min.js"></script> <script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script> <script type="text/javascript" src="/assets/plugins/back-to-top.js"></script> <!-- JS Implementing Plugins --> <script type="text/javascript" src="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.js"></script> <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script> <script type="text/javascript" src="/assets/plugins/gmap/gmap.js"></script> <!-- JS Customization --> <script type="text/javascript" src="/assets/js/custom.js"></script> <!-- JS Page Level --> <script type="text/javascript" src="/assets/js/app.js"></script> <script type="text/javascript" src="/assets/js/pages/index.js"></script> <script type="text/javascript" src="/assets/js/plugins/owl-carousel.js"></script> <script type="text/javascript"> jQuery(document).ready(function() { App.init(); OwlCarousel.initOwlCarousel(); Contact.initMap(); }); </script> <!--[if lt IE 9]> <script src="/assets/plugins/respond.js"></script> <script src="/assets/plugins/html5shiv.js"></script> <script src="/assets/js/plugins/placeholder-IE-fixes.js"></script> <![endif]--> </body> </html>
