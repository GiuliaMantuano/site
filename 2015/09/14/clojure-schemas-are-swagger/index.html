<!DOCTYPE html> <!--[if IE 8]> <html lang="en" class="ie8"> <![endif]--> <!--[if IE 9]> <html lang="en" class="ie9"> <![endif]--> <!--[if !IE]><!--> <html lang="en"> <!--<![endif]--> <head> <title>Clojure (Prismatic) Schemas are Swagger | Codurance </title> <!-- Meta --> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1.0"> <meta name="description" content="Our team of dedicated software craftsmen provides consultancy, software development, and training services to clients seeking high quality development processes and software solutions."> <meta name="author" content="Codurance Ltd"> <!-- Open Graph tags - Used when publishing on Facebook --> <meta property="og:site_name" content="Codurance"/> <meta property="og:description" content="Our team of dedicated software craftsmen provides consultancy, software development, and training services to clients seeking high quality development processes and software solutions."/> <meta property="og:url" content="http://codurance.com"/> <meta property="og:image" content="http://codurance.com/assets/img/codurance.png"/> <!-- Favicon --> <link rel="shortcut icon" href="/assets/img/favicon.ico"> <!-- CSS Global Compulsory --> <link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css"> <link rel="stylesheet" href="/assets/css/style.css"> <link rel="stylesheet" href="/assets/css/blocks.css"> <link rel="stylesheet" href="/assets/css/blog.style.css"> <!-- CSS Implementing Plugins --> <link rel="stylesheet" href="/assets/plugins/line-icons/line-icons.css"> <link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.min.css"> <link rel="stylesheet" href="/assets/plugins/owl.carousel.2.0.0/assets/owl.carousel.css"> <!-- CSS Theme --> <link rel="stylesheet" href="/assets/css/plugins.css"> <link rel="stylesheet" href="/assets/css/app.css"> <link rel="stylesheet" href="/assets/css/pages/blog.css"> <link rel="stylesheet" href="/assets/css/theme-colors/orange.css"> <link rel="stylesheet" href="/assets/css/headers/header-default.css"> <link rel="stylesheet" href="/assets/css/footers/footer-v1.css"> <!-- CSS Customization --> <link rel="stylesheet" href="/assets/css/custom.css"> <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/styles/idea.min.css"> <!--fonts --> <link href='http://fonts.googleapis.com/css?family=Oxygen:700,400' rel='stylesheet' type='text/css'> <link href='http://fonts.googleapis.com/css?family=Open+Sans' rel='stylesheet' type='text/css'> <script> (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){ (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o), m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m) })(window,document,'script','//www.google-analytics.com/analytics.js','ga'); ga('create', 'UA-46289079-1', 'codurance.com'); ga('send', 'pageview'); </script> <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.8.0/highlight.min.js"></script> <script>hljs.initHighlightingOnLoad();</script> <!-- ShareThis --> <script type="text/javascript">var switchTo5x=true;</script> <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script> <script type="text/javascript">stLight.options({publisher: "8b795ed1-9577-43d1-9e4e-55c54306336b", doNotHash: true, doNotCopy: false, hashAddressBar: false});</script> </head> <body > <div class="wrapper"> <!--=== Header ===--> <div class="header no-topbar"> <div class="container"> <!-- Logo --> <a class="logo" href="/"> <img class="logo-header" src="/assets/img/codurance.png" alt="Codurance Logo" height="45px;"> </a> <!-- End Logo --> <!-- Toggle get grouped for better mobile display --> <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse"> <span class="sr-only">Toggle navigation</span> <span class="fa fa-bars"></span> </button> <!-- End Toggle --> </div><!--/end container--> <!-- Collect the nav links, forms, and other content for toggling --> <div class="collapse navbar-collapse mega-menu navbar-responsive-collapse"> <div class="container"> <ul class="nav navbar-nav"> <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown">Services <i class="icon-angle-down">&nbsp;</i></a><ul class="dropdown-menu"> <li><a href="/services/software-creation">Software Creation</a></li> <li><a href="/services/training">Training</a></li> </ul></li> <li><a href="/videos">Videos</a></li> <li><a href="/blog">Blog</a></li> <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown">About Us <i class="icon-angle-down">&nbsp;</i></a><ul class="dropdown-menu"> <li><a href="/aboutus/ourteam">Our Team</a></li> <li><a href="/aboutus/ourcompany">Our Company</a></li> <li><a href="/aboutus/ourpractices">Our Practices</a></li> <li><a href="http://www.meetup.com/london-software-craftsmanship">Our Community</a></li> </ul></li> <li><a href="/work-with-us">Work with us</a></li> <li><a href="/aboutus/contact">Contact us</a></li> </ul> </div><!--/end container--> </div><!--/navbar-collapse--> </div> <!--=== End Header ===--> <div class="bg-color-light"> <div class="container content-sm"> <div class="row blog-page blog-item"> <!-- Left Sidebar --> <div class="col-md-9"> <!--Blog Post--> <div class="news-v3 bg-color-white margin-bottom-30"> <div class="news-v3-in shareThisButtons"> <h1>Clojure (Prismatic) Schemas are Swagger</h1> <ul class="list-inline posted-info"> <li>By <a class='author' href='/blog/author/mashooq-badar/'>Mashooq Badar</a></li> <li>Posted 14 Sep 2015</li> <li> <a href="/blog/tag/clojure/"><i class="fa fa-tags"></i><span class="blog-tag-margin"> clojure</span></a> <a href="/blog/tag/swagger/"><i class="fa fa-tags"></i><span class="blog-tag-margin"> swagger</span></a> <a href="/blog/tag/rest/"><i class="fa fa-tags"></i><span class="blog-tag-margin"> REST</span></a> </li> </ul> <p>Recently, I decided to include Swagger documentation to our time sheet application. Although Swagger provides tools to help clients integrate with your REST API the most powerful feature, in my opinion, is that it acts as "living documentation" for the API. Adding Swagger to my the application had a couple of pleasant side-effects:</p> <p>Idiomatic Clojure encourages the use of data structures such as maps. This work really well because JSON to/from Clojure Map translation, and persistence becomes straight forward whether you are using the <a href="https://github.com/clojure/java.jdbc">org.clojure/java.jdbc</a> or persisting to a document database such as MongoDB. However, The problem with this approach is that understanding your entities becomes difficult. You often need to resort to the DDL for this purpose and in case of some databases you may not even have that. In cases where you are using migrations - your DDL may be scattered across many migrations over time. The Swagger support provided by <a href="https://github.com/metosin/compojure-api">metosin/compojure-api</a> uses <a href="https://github.com/Prismatic/schema">prismatic/schema</a> to define your API. Here is an example of what Activity and a list of Activities looks like in my time sheet application:</p><pre><code class="clojure ">(def Activity {
  :id s/Num
  :name s/Str
  :description s/Str
  :activitytype (s/enum "Daily" "Hourly") })

(def Activities [Activity])
</code></pre><p>Prismatic Schema provides other features such as attribute optionality, value optionality, custom schema types etc. See <a href="https://github.com/Prismatic/schema">README</a> for more details.</p> <p>Now that I have a single place where I can go to fully understand how my entities/value-objects looks like. The same entities/value-objects are used in my route definitions to define the REST API.</p><pre><code class="clojure">(GET* "/activity" []
  :return Activities
  :summary "All activities in the system"
  (ok (auth #(controller/get-activities))))

(PUT* "/activity" []
  :body [activity Activity]
  :summary "Update an activity"
  (ok (auth #(controller/update-activity activity))))
</code></pre><p>Here I am creating two routes for GET and PUT HTTP requests. In case of GET, I will return Activities and in case of PUT I expect an Activity in the body and return nothing. In both cases I return a HTTP OK code. The 'auth' call allows me to authenticate the user before the call to the controller is made. The Compojure API can generate the full Swagger UI, allowing client developers to explore and invoke the API (if they have the right access of course!).</p> <p>The generated Swagger UI looks like the following.</p> <p><img src="/assets/img/custom/blog/2015-09-14-swagger-clojure/swagger-doc.png" alt="Generated Swagger Documentation" /></p> <p>The Compojure API validates every request/response against the model so that any violation of the API will result in a failure. This brings me to the second side-effect; you can validate the model against your tests! In my case I validate the model against my controllers:</p><pre><code class="clojure">(defn ^:always-validate get-activities :- Activities []
  (model/get-activities))

(defn ^:always-validate update-activity [activity :- Activity]
  (model/update-activity activity))
</code></pre><p>Using the <code>^:always-validate</code> meta data will validate my tests against the model. In this case my functional tests are testing the system from controllers to the database allowing me to enforce the schema at build time.</p> <p>Clojure is a dynamic language. One of its main criticisms is a lack of types. Although there is some good work in progress by the <a href="http://typedclojure.org/">Typed Clojure</a> project, I think the Prismatic Schema library provides a very good compromise and the fact that it plays nicely with Swagger is an icing on the cake.</p> <div id="sharethisButtons"> <span class='pull-right st_twitter_large' displayText='Tweet' st_url='http://codurance.com/2015/09/14/clojure-schemas-are-swagger/'></span> <span class='pull-right st_linkedin_large' displayText='LinkedIn' st_url='http://codurance.com/2015/09/14/clojure-schemas-are-swagger/'></span> <span class='pull-right st_email_large' displayText='Email' st_url='http://codurance.com/2015/09/14/clojure-schemas-are-swagger/'></span> <span class='pull-right st_sharethis_large' displayText='ShareThis' st_url='http://codurance.com/2015/09/14/clojure-schemas-are-swagger/'></span> </div> </div> </div> <!--End Blog Post--> <!--About the author--> <div class = "blog-author bg-color-white margin-bottom-30"> <div class="headline headline-md margin-bottom-30"> <h2>About the author</h2> </div> <div class="row"> <div class="col-sm-3 pull-left"> <img class="img-responsive" id="author-img" src="/assets/img/custom/team/mash_badar.jpg"> </div> <div class="col-sm-9"> <div class="blog-author-desc"> <div class="overflow-h"> <h4>Mashooq Badar</h4> <ul class="list-inline"> <li><a href="https://twitter.com/intent/tweet?text=.%20@mashooq%20Type%20your%20text%20here&url=http://codurance.com/2015/09/14/clojure-schemas-are-swagger/&via=codurance"><i class="fa fa-twitter"></i></a></li> </ul> </div> <p><p>Mash is a software craftsman with extensive experience in developing innovative solutions and running large scale enterprise projects. For many years he was a Principal Consultant leading some of the most diverse projects for clients in Government, Media and Finance. Before Codurance Mash was a Director at UBS leading a 4 million pounds a year project with 6 development teams situated in London and Krakow. He started the project from scratch, building the teams a developer at a time.</p><p>Mash is an associated organiser for LSCC, involved since the beginning helping with organisation and running hands-on sessions. Mash has a passion for developing; teams that are skillful and passionate, solutions that are innovative and simple, and software that is aligned to it's business and flexible to change.</p></p> </div> </div> </div> </div> <!--End About the author--> </div> <!-- End Left Sidebar --> <!-- Right Sidebar --> <div class="col-md-3"> <!--Related Blog Posts--> <div class="posts margin-bottom-40"> <div class="headline-v2"> <h2>Related Blogs</h2> </div> <div class="blog-thumb blog-thumb-circle margin-bottom-15"> <div class="blog-thumb-hover"> <a href="/2016/01/10/clojure-vim-environment/"> <img class="rounded-x" src="/assets/img/custom/blog/vimenv.png" alt=""></img> </a> <a class="hover-grad" href="blog_single.html"> <i class="fa fa-hand-spock-o"></i> </a> </div> <div class="blog-thumb-desc"> <h3><a href="/2016/01/10/clojure-vim-environment/">Clojure VIM Environment</a></h3> <ul class="blog-thumb-info"> <li> Mashooq Badar </li> </ul> </div> </div> <!--End Related Blog Posts--> </div> <!-- Recent blogs --> <div class="posts margin-bottom-40"> <div class="headline-v2"><h2>Recent Blogs</h2></div> <div class="blog-thumb blog-thumb-circle margin-bottom-15"> <div class="blog-thumb-hover"> <a href="/2016/04/28/async-systems-with-sync-clients/"> <img class="rounded-x" src="/assets/img/custom/blog/time.png" alt=""></img> </a> <a class="hover-grad" href="blog_single.html"> <i class="fa fa-hand-spock-o"></i> </a> </div> <div class="blog-thumb-desc"> <h3><a href="/2016/04/28/async-systems-with-sync-clients/">Async systems with sync clients</a></h3> <ul class="blog-thumb-info"> <li> Felipe Fernández </li> </ul> </div> </div> <div class="blog-thumb blog-thumb-circle margin-bottom-15"> <div class="blog-thumb-hover"> <a href="/2016/04/17/sorted-pagination-in-cassandra/"> <img class="rounded-x" src="/assets/img/custom/blog/cassandra.png" alt=""></img> </a> <a class="hover-grad" href="blog_single.html"> <i class="fa fa-hand-spock-o"></i> </a> </div> <div class="blog-thumb-desc"> <h3><a href="/2016/04/17/sorted-pagination-in-cassandra/">Sorted pagination in Cassandra</a></h3> <ul class="blog-thumb-info"> <li> Felipe Fernández </li> </ul> </div> </div> <div class="blog-thumb blog-thumb-circle margin-bottom-15"> <div class="blog-thumb-hover"> <a href="/2016/04/12/we-did-it-wrong-but-not-in-vain/"> <img class="rounded-x" src="/assets/img/custom/blog/2016-04-12-we-did-it-wrong.jpg" alt=""></img> </a> <a class="hover-grad" href="blog_single.html"> <i class="fa fa-hand-spock-o"></i> </a> </div> <div class="blog-thumb-desc"> <h3><a href="/2016/04/12/we-did-it-wrong-but-not-in-vain/">We did it wrong, but not all was in vain</a></h3> <ul class="blog-thumb-info"> <li> Sandro Mancuso </li> </ul> </div> </div> <div class="blog-thumb blog-thumb-circle margin-bottom-15"> <div class="blog-thumb-hover"> <a href="/2016/03/28/Mutual-Problems/"> <img class="rounded-x" src="/assets/img/custom/blog/2016-03-28-https.jpg" alt=""></img> </a> <a class="hover-grad" href="blog_single.html"> <i class="fa fa-hand-spock-o"></i> </a> </div> <div class="blog-thumb-desc"> <h3><a href="/2016/03/28/Mutual-Problems/">Mutual Problems</a></h3> <ul class="blog-thumb-info"> <li> Robert Firek </li> </ul> </div> </div> <div class="blog-thumb blog-thumb-circle margin-bottom-15"> <div class="blog-thumb-hover"> <a href="/2016/03/17/code-smells-part-I/"> <img class="rounded-x" src="/assets/img/custom/blog/code-smells.jpg" alt=""></img> </a> <a class="hover-grad" href="blog_single.html"> <i class="fa fa-hand-spock-o"></i> </a> </div> <div class="blog-thumb-desc"> <h3><a href="/2016/03/17/code-smells-part-I/">Code Smells – Part I</a></h3> <ul class="blog-thumb-info"> <li> Ana Nogal </li> </ul> </div> </div> <div class="blog-thumb blog-thumb-circle margin-bottom-15"> <div class="blog-thumb-hover"> <a href="/2016/03/16/Containers-all-the-way-through/"> <img class="rounded-x" src="/assets/img/custom/blog/2016-03-16-containers-all-the-way-through/cover-image.png" alt=""></img> </a> <a class="hover-grad" href="blog_single.html"> <i class="fa fa-hand-spock-o"></i> </a> </div> <div class="blog-thumb-desc"> <h3><a href="/2016/03/16/Containers-all-the-way-through/">Containers all the way through...</a></h3> <ul class="blog-thumb-info"> <li> Mani Sarkar </li> </ul> </div> </div> <div class="blog-thumb blog-thumb-circle margin-bottom-15"> <div class="blog-thumb-hover"> <a href="/2016/03/03/cohesion-cornerstone-software-design/"> <img class="rounded-x" src="/assets/img/custom/blog/2016-03-03-cohesion.jpg" alt=""></img> </a> <a class="hover-grad" href="blog_single.html"> <i class="fa fa-hand-spock-o"></i> </a> </div> <div class="blog-thumb-desc"> <h3><a href="/2016/03/03/cohesion-cornerstone-software-design/">Cohesion - The cornerstone of Software Design</a></h3> <ul class="blog-thumb-info"> <li> Sandro Mancuso </li> </ul> </div> </div> <!-- End Recent blogs --> </div> <!-- End Right Sidebar --> </div> <!--/row--> </div> <!--/container--> </div> <!-- background color --> </div> <!--=== Copyright ===--> <!--=== Footer ===--> <div id="footer-v1" class="footer-v1"> <div class="footer"> <div class="container"> <div class="row"> <!-- About --> <div class="col-md-3 md-margin-bottom-40"> <a href="/"> <img id="logo-footer" class="footer-logo" src="/assets/img/footer-logo.png" alt="Codurance"> </a> <p>Software is our passion. </p> <p>We are software craftsmen. We build well-crafted software for our customers, we help developers to get better at their craft through training, coaching and mentoring, and we help companies get better at delivering software. </p> </div><!--/col-md-3--> <!-- End About --> <!-- Latest --> <div class="col-md-3 md-margin-bottom-40"> <div class="posts"> <div class="headline"><h2>Latest Blogs</h2></div> <ul class="list-unstyled latest-list"> <li> <a href="/2016/04/28/async-systems-with-sync-clients/" alt="Async systems with sync clients">Async systems with sync clients...</a> <small>Felipe Fernández</small> </li> <li> <a href="/2016/04/17/sorted-pagination-in-cassandra/" alt="Sorted pagination in Cassandra">Sorted pagination in Cassandra</a> <small>Felipe Fernández</small> </li> <li> <a href="/2016/04/12/we-did-it-wrong-but-not-in-vain/" alt="We did it wrong, but not all was in vain">We did it wrong, but...</a> <small>Sandro Mancuso</small> </li> </ul> </div> </div><!--/col-md-3--> <!-- End Latest --> <!-- Link List --> <div class="col-md-3 md-margin-bottom-40"> <div class="headline"><h2>Useful Links</h2></div> <ul class="list-unstyled link-list"> <li><a href="/services">Services</a><i class="fa fa-angle-right"></i></li> <li><a href="/videos">Videos</a><i class="fa fa-angle-right"></i></li> <li><a href="/blog">Blog</a><i class="fa fa-angle-right"></i></li> <li><a href="/work-with-us">Work with us</a><i class="fa fa-angle-right"></i></li> <li><a href="/aboutus/ourcompany">About us</a><i class="fa fa-angle-right"></i></li> </ul> </div><!--/col-md-3--> <!-- End Link List --> <!-- Contact Us --> <div class="col-md-3 map-img md-margin-bottom-40"> <div class="headline"><h2>Contact Us</h2></div> <address class="md-margin-bottom-40"> <a href="https://www.google.co.uk/maps/place/I2+Office+Aldersgate/@51.5175798,-0.0978509,19z/data=!4m2!3m1!1s0x0000000000000000:0x71133b028b4f269d" target="_blank">200 Aldersgate, EC1A 4HD<br> London, UK </a><br> Phone: +44 203 440 4015 <br> Email: <a href="mailto:hello@codurance.com" target="_blank" class="">hello@codurance.com</a> </address> </div><!--/col-md-3--> <!-- End Contact Us --> </div> </div> </div><!--/footer--> <div class="copyright"> <div class="container"> <div class="row"> <div class="col-md-6"> <p> Company Registration No: 8712584 </p> </div> <!-- Social Links --> <div class="col-md-6"> <ul class="footer-socials list-inline"> <li> <a href="https://www.facebook.com/codurance/" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Facebook" target="_blank"> <i class="fa fa-facebook"></i> </a> </li> <li> <a href="https://www.linkedin.com/company/codurance" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Linkedin" target="_blank"> <i class="fa fa-linkedin"></i> </a> </li> <li> <a href="https://twitter.com/codurance" class="tooltips" data-toggle="tooltip" data-placement="top" title="" data-original-title="Twitter" target="_blank"> <i class="fa fa-twitter"></i> </a> </li> <li> <a href="/atom.xml" data-original-title="Feed" class="tooltips" data-toggle="tooltip" data-placement="top" title="" target="_blank"> <i class="fa fa-rss"></i> </a> </li> </ul> </div> <!-- End Social Links --> </div> </div> </div><!--/copyright--> </div> <!--=== End Footer ===--> <!--=== End Copyright ===--> </div> <!-- JS Global Compulsory --> <script type="text/javascript" src="/assets/plugins/jquery/jquery.min.js"></script> <script type="text/javascript" src="/assets/plugins/jquery/jquery-migrate.min.js"></script> <script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script> <script type="text/javascript" src="/assets/plugins/back-to-top.js"></script> <!-- JS Implementing Plugins --> <script type="text/javascript" src="/assets/plugins/owl.carousel.2.0.0/owl.carousel.min.js"></script> <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script> <script type="text/javascript" src="/assets/plugins/gmap/gmap.js"></script> <!-- JS Customization --> <script type="text/javascript" src="/assets/js/custom.js"></script> <!-- JS Page Level --> <script type="text/javascript" src="/assets/js/app.js"></script> <script type="text/javascript" src="/assets/js/pages/index.js"></script> <script type="text/javascript"> jQuery(document).ready(function() { App.init(); Contact.initMap(); }); </script> </body> </html>
