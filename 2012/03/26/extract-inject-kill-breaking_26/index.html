<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
<title>Codurance - Extract, Inject, Kill: Breaking hierarchies (part 3)</title>
 <!-- Meta -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

<!-- Open Graph tags - Used when publishing on Facebook -->
<meta property="og:site_name" content="Codurance"/>
<meta property="og:description" content="We build well-crafted software"/>
<meta property="og:url" content="http://codurance.com"/>
<meta property="og:image" content="http://codurance.com/assets/img/codurance.png"/>

<!-- Favicon -->
<link rel="shortcut icon" href="/assets/img/favicon.ico">

<!-- CSS Global Compulsory -->
<link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/assets/css/style.css">

<!-- CSS Implementing Plugins -->
<link rel="stylesheet" href="/assets/plugins/line-icons/line-icons.css">
<link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.css">

<!-- CSS Theme -->
<link rel="stylesheet" href="/assets/css/plugins.css">
<link rel="stylesheet" href="/assets/css/app.css">
<link rel="stylesheet" href="/assets/css/theme-colors/orange.css" id="style_color">

<!-- CSS Customization -->
<link rel="stylesheet" href="/assets/css/custom.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/idea.min.css">
<!--fonts -->
<link href='http://fonts.googleapis.com/css?family=Oxygen:700,400' rel='stylesheet' type='text/css'>



<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46289079-1', 'codurance.com');
    ga('send', 'pageview');
</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</head>

<body>

<div class="wrapper">
<!--=== Header ===-->
<div class="header-v3 header-sticky">
        <!-- Navbar -->
        <div class="navbar navbar-default" role="navigation">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="fa fa-bars"></span>
                    </button>
                    <a class="navbar-brand" href="/">
                        <img id="logo-header" src="/assets/img/codurance.png" height="45px;" alt="Logo">
                    </a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse navbar-responsive-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/services">Services</a></li>
                        <li><a href="/casestudies">Case Studies</a></li>
                        <li><a href="/videos">Videos</a></li>
                        <li><a href="/blog">Blog</a></li>
                        <li><a href="/careers/craftsman">Careers</a></li>
                        <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown">About Us <i class="icon-angle-down">&nbsp;</i></a><ul class="dropdown-menu">
                            <li><a href="/aboutus/ourteam">Our Team</a></li>
                            <li><a href="/aboutus/ourcompany">Our Company</a></li>
                            <li><a href="/aboutus/ourpractices">Our Practices</a></li>
                        </ul></li>
                    </ul>
                </div><!--/navbar-collapse-->
            </div>    
        </div>            
        <!-- End Navbar -->
    </div>
    <!--=== End Header ===--> 
<!--=== End Header ===-->


    <div class="breadcrumbs margin-bottom-10">
        <div class="container">
            <h2 class="pull-left">Extract, Inject, Kill: Breaking hierarchies (part 3)</h2>
            <ul class="pull-right breadcrumb">
                <li><a href="/">Home</a></li>
                
                    <li>
                    
                        <a href="/blog">Blog</a>
                    
                    </li>
                
            </ul>
        </div>
    </div>



<div class="container">
<div class="row blog-page blog-item">
<!-- Left Sidebar -->
<div class="col-md-9 md-margin-bottom-60">
    <!--Blog Post-->
    <div class="blog margin-bottom-40">
        
        <div class="blog-post-tags">
            <ul class="list-unstyled list-inline blog-info">
                <li><i class="fa fa-calendar"></i> 26 Mar 2012</li>
                <li><i class="fa fa-pencil"></i> Sandro Mancuso</li>
                <li class="blog-share-buttons">
                  <script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
                  <script type="IN/Share"></script>

                  <a class="twitter-share-button"
                      href="https://twitter.com/intent/tweet?url=http://www.codurance.com/2012/03/26/extract-inject-kill-breaking_26/"
                      data-count="none">
                      Tweet</a>
                </li>
            </ul>
        </div>
        

        

        <p><em>In <a href="/2012/03/06/extract-inject-kill-breaking/">part one</a>
I explain the main idea behind this approach and in <a href="/2012/03/06/extract-inject-kill-breaking_06/">part two</a>
I start this example. Please read parts
<a href="/2012/03/06/extract-inject-kill-breaking/">one</a>
and
<a href="/2012/03/06/extract-inject-kill-breaking_06/">two</a>
before reading this post</em></p>

<p>Although the main ideas of Extract, Inject, Kill is already expressed,
it's good to finish the
<a href="/2012/03/06/extract-inject-kill-breaking_06/">exercise</a>
just for completion's sake. Here is where we stopped:</p>

<p><img src="/assets/img/custom/blog/hierarchies_2.png" alt="Hierarchies" />
Let's have a look at the VoucherPricingService, that now is the only
concrete class at the bottom of our hierarchy. </p>

<p>Note that it uses the VoucherService class to calculate the voucher
value.</p>

<p>Before anything, let's write some tests to VoucherPricingService.java</p>

<p>Once thing to notice is that the User parameter is not used for
anything. So let's remove it.</p>

<p>Now it is time to user the Extract, Inject, Kill on the
VoucherPricingService. Let's <strong>Extract</strong> the content of the
VoucherPricingService.applyAdditionalDiscounts(double, String) method
and add it to a class called VoucherDiscountCalculation. Let's call the
method calculateVoucherDiscount(). Of course, let's do that writing our
tests first. They need to test exactly the same things that are tested
on VoucherPricingService.applyAdditionalDiscounts(double, String). We
also take the opportunity to pass the VoucherService object into the
constructor of VoucherDiscountCalculation.</p>

<p>If you noticed, when doing the extraction, we took the opportunity to
give proper names to our new classes and methods and also to pass their
essential dependencies to the constructor instead of using method
injection.
 
Let's now change the code in the VoucherPricingServiceto use the new
VoucherDiscountCalculation and see if all the tests still pass.</p>

<p>Cool. All the tests still pass, meaning that we have the same behaviour,
but now in the VoucherDiscountCalculation class, and we are ready to
move to the <strong>Inject</strong> stage.</p>

<p>Let's now <strong>inject</strong> VoucherDiscountCalculation into PricingService,
that is the top class in the hierarchy. As always, let's add a test that
will test this new collaboration.</p>

<p>And here is the changed PriningService.</p>

<p>Now it is time to <strong>kill</strong> the VoucherPricingService class and <strong>kill</strong>
the PricingService.applyAdditionalDiscounts(double total, String
voucher) template method, since it is not being used anymore. We can
also <strong>kill</strong> the VoucherPricingServiceTest class and fix the
PricingServiceTest removing the applyAdditionalDiscounts() method from
the testable class.</p>

<p>So now, of course, we don't have a concrete class in our hierarchy
anymore, since the VoucherPricingService was the only one. We can now
safely promote UserDiscountPricingService to concrete.</p>

<p>That is now how our object graph looks like:</p>

<p><img src="/assets/img/custom/blog/class_hierarchies_v4.png" alt="Hierarchies" /></p>

<p>Our hierarchy is another level short. The only thing we need to do now
is to apply  <strong>Extract, Inject, Kill </strong>once again, <strong>extracting</strong> the
logic inside UserDiscountPricingService into another class (e.g.
UserDiscountCalculation), <strong>inject</strong> UserDiscountCalculation into
PricingService, finally <strong>kill</strong> UserDiscountPricingService and the
calculateDiscount(User user) template method. 
UserDiscountPricingService, </p>

<p>Since the approach was described before, there is no need to go step by
step anymore. Let's have a look at the final result.</p>

<p>Here is the diagram representing where we started:</p>

<p><img src="/assets/img/custom/blog/hierarchies.png" alt="Hierarchies" /></p>

<p>After the last Extract, Inject, Kill refactoring, this is what we've
got:</p>

<p><img src="/assets/img/custom/blog/hierarchies_classes_final.png" alt="Hierarchies" /></p>

<p>The cool thing about the final model pictured above is that now we don't
have any abstract classes anymore. All classes and methods are concrete
and every single class is independently testable. </p>

<p>That's how the final PricingService class looks like:</p>

<p>For a full implementation of the final code, please look
at <a href="https://github.com/sandromancuso/breaking-hierarchies">https://github.com/sandromancuso/breaking-hierarchies</a></p>

<p><em>Note: For this three part blog post I used three different approaches
to drawing UML diagrams. By hand, using
<a href="http://argouml.tigris.org/">ArgoUML</a> and <a href="http://astah.net/editions/community">Astah community
edition</a>. I'm very happy with the
latter. </em></p>


        
    </div>
    <!--End Blog Post-->
</div>
<!-- End Left Sidebar -->

<!-- Right Sidebar -->
<div class="col-md-3 magazine-page">
    <!-- Blog Latest Tweets -->
    <div class="blog-twitter margin-bottom-30">
        <a class="twitter-timeline" href="https://twitter.com/mashooq/codurance" data-widget-id="400789734676385792">Tweets from Codurance team</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<script>window.twttr = (function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0],t = window.twttr || {};if (d.getElementById(id)) return t;js = d.createElement(s);js.id = id;js.src = "https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, "script", "twitter-wjs"));</script>
    </div>
    <!-- End Blog Latest Tweets -->
</div>
<!-- End Right Sidebar -->
</div>
<!--/row-->
</div>
<!--/container-->


<!--=== Copyright ===-->
<div class="footer-default">
    <div class="copyright">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <p class="copyright-space">
                         Company Registration No: 8712584
                         | Contact us: <a href="mailto:hello@codurance.com" class="">hello@codurance.com</a>
                         | Phone: +44 203 440 4015
                    </p>

                </div>
                <div class="col-md-4">
                    <ul class="social-icons pull-right">
                        <li><a href="/atom.xml" data-original-title="Feed" class="social_rss"></a></li>
                        <li><a href="http://twitter.com/codurance" data-original-title="Twitter" class="social_twitter"></a></li>
                    </ul>
                </div>
            </div> <!--/row-->
        </div> <!--/container-->
    </div><!--/copyright-->
</div>

<!--=== End Copyright ===-->
</div>

<!-- JS Global Compulsory -->
<script type="text/javascript" src="/assets/plugins/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/assets/plugins/jquery/jquery-migrate.min.js"></script>
<script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/assets/plugins/back-to-top.js"></script>
<!-- JS Implementing Plugins -->
<script type="text/javascript" src="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript" src="/assets/plugins/gmap/gmap.js"></script>
<!-- JS Customization -->
<script type="text/javascript" src="/assets/js/custom.js"></script>
<!-- JS Page Level -->
<script type="text/javascript" src="/assets/js/app.js"></script>
<script type="text/javascript" src="/assets/js/pages/index.js"></script>

<script type="text/javascript">
    jQuery(document).ready(function() {
        App.init();
        Index.initOwlCarousel();
        Contact.initMap();
    });
</script>
<!--[if lt IE 9]>
    <script src="/assets/plugins/respond.js"></script>
    <script src="/assets/plugins/html5shiv.js"></script> 
    <script src="/assets/js/plugins/placeholder-IE-fixes.js"></script>   
<![endif]-->

</body>
</html>
