<!DOCTYPE html>
<!--[if IE 8]> <html lang="en" class="ie8"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9"> <![endif]-->
<!--[if !IE]><!--> <html lang="en"> <!--<![endif]-->
<head>
<title>Codurance - Test-driving Builders with Mockito and Hamcrest</title>
 <!-- Meta -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="">
<meta name="author" content="">

<!-- Open Graph tags - Used when publishing on Facebook -->
<meta property="og:site_name" content="Codurance"/>
<meta property="og:description" content="We build well-crafted software"/>
<meta property="og:url" content="http://codurance.com"/>
<meta property="og:image" content="http://codurance.com/assets/img/codurance.png"/>

<!-- Favicon -->
<link rel="shortcut icon" href="/assets/img/favicon.ico">

<!-- CSS Global Compulsory -->
<link rel="stylesheet" href="/assets/plugins/bootstrap/css/bootstrap.min.css">
<link rel="stylesheet" href="/assets/css/style.css">

<!-- CSS Implementing Plugins -->
<link rel="stylesheet" href="/assets/plugins/line-icons/line-icons.css">
<link rel="stylesheet" href="/assets/plugins/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" href="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.css">

<!-- CSS Theme -->
<link rel="stylesheet" href="/assets/css/plugins.css">
<link rel="stylesheet" href="/assets/css/app.css">
<link rel="stylesheet" href="/assets/css/theme-colors/orange.css" id="style_color">

<!-- CSS Customization -->
<link rel="stylesheet" href="/assets/css/custom.css">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/styles/idea.min.css">
<!--fonts -->
<link href='http://fonts.googleapis.com/css?family=Oxygen:700,400' rel='stylesheet' type='text/css'>



<script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-46289079-1', 'codurance.com');
    ga('send', 'pageview');
</script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/8.5/highlight.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</head>

<body>

<div class="wrapper">
<!--=== Header ===-->
<div class="header-v3 header-sticky">
        <!-- Navbar -->
        <div class="navbar navbar-default" role="navigation">
            <div class="container">
                <!-- Brand and toggle get grouped for better mobile display -->
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-responsive-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="fa fa-bars"></span>
                    </button>
                    <a class="navbar-brand" href="/">
                        <img id="logo-header" src="/assets/img/codurance.png" height="45px;" alt="Logo">
                    </a>
                </div>

                <!-- Collect the nav links, forms, and other content for toggling -->
                <div class="collapse navbar-collapse navbar-responsive-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="/services">Services</a></li>
                        <li><a href="/casestudies">Case Studies</a></li>
                        <li><a href="/videos">Videos</a></li>
                        <li><a href="/blog">Blog</a></li>
                        <li><a href="/careers/craftsman">Careers</a></li>
                        <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown">About Us <i class="icon-angle-down">&nbsp;</i></a><ul class="dropdown-menu">
                            <li><a href="/aboutus/ourteam">Our Team</a></li>
                            <li><a href="/aboutus/ourcompany">Our Company</a></li>
                            <li><a href="/aboutus/ourpractices">Our Practices</a></li>
                        </ul></li>
                    </ul>
                </div><!--/navbar-collapse-->
            </div>    
        </div>            
        <!-- End Navbar -->
    </div>
    <!--=== End Header ===--> 
<!--=== End Header ===-->


    <div class="breadcrumbs margin-bottom-10">
        <div class="container">
            <h2 class="pull-left">Test-driving Builders with Mockito and Hamcrest</h2>
            <ul class="pull-right breadcrumb">
                <li><a href="/">Home</a></li>
                
                    <li>
                    
                        <a href="/blog">Blog</a>
                    
                    </li>
                
            </ul>
        </div>
    </div>



<div class="container">
<div class="row blog-page blog-item">
<!-- Left Sidebar -->
<div class="col-md-9 md-margin-bottom-60">
    <!--Blog Post-->
    <div class="blog margin-bottom-40">
        
        <div class="blog-post-tags">
            <ul class="list-unstyled list-inline blog-info">
                <li><i class="fa fa-calendar"></i> 09 Jun 2012</li>
                <li><i class="fa fa-pencil"></i> Sandro Mancuso</li>
                <li class="blog-share-buttons">
                  <script src="//platform.linkedin.com/in.js" type="text/javascript"> lang: en_US</script>
                  <script type="IN/Share"></script>

                  <a class="twitter-share-button"
                      href="https://twitter.com/intent/tweet?url=http://www.codurance.com/2012/06/09/test-driving-builders-with-mockito-and/"
                      data-count="none">
                      Tweet</a>
                </li>
            </ul>
        </div>
        

        

        <p>A lot of people asked me in the past if I test getters and setters
(properties, attributes, etc). They also asked me if I test my builders.
The answer, in my case is it depends.</p>

<p>When working with legacy code, I wouldn’t bother to test data
structures, that means, objects with just getters and setters, maps,
lists, etc. One of the reasons is that I never mock them. I use them as
they are when testing the classes that uses them.
For builders, when they are used just by test classes, I also don’t unit
test them since they are used as “helpers” in many other tests. If they
have a bug, the tests will fail.
In summary, if these data structures and builders already exist, I
wouldn’t bother retrofitting test for them.</p>

<p>But now let’s talk about doing TDD and assume you need a new object with
getters and setters. In this case, yes, I would write tests for the
getters and setters since I need to justify their existence writing my
tests first.</p>

<p>In order to have a rich domain model, I normally tend to have business
logic associated with the data and have a richer domain model. Let’s see
the following example.</p>

<p>In the real life, I would be writing on test at a time, making them pass
and refactor. For this post, I’ll just give you the full classes for
clarity’s sake. First let’s write the tests:</p>

<p>Now the implementation:</p>

<p>This case is interesting since the Trade object has one property called
inboundMessage with respective getters and setters and also uses a
collaborator (reportabilityDecision, injected via setter) in its
isReportable business method.</p>

<p>A common approach that I’ve seen many times to “test” the
setReportabilityDecision method is to introduce a
getReportabilityDecision method returning the reportabilityDecision
(collaborator) object.</p>

<p>This is definitely the wrong approach. Our objective should be to test
how the collaborator is used, that means, if it is invoked with the
right parameters and if whatever it returns (if it returns anything) is
used. Introducing a getter in this case does not make sense since it
does not guarantee that the object, after had the collaborator injected
via setter, is interacting with the collaborator as we intended.</p>

<p><em>As an aside, when we write tests that are about how collaborators are
going to be used, defining their interface, is when we are using TDD as
a design tool and not just simply as a testing tool. I’ll cover that in
a future blog post.</em></p>

<p>OK, now imagine that this trade object can be created in different ways,
that means, with different reportability decisions. We also would like
to make our code more readable and we decide to write a builder for the
Trade object. Let’s also assume, in this case, that we want the builder
to be used in the production and test code as well. 
In this case, we want to test drive our builder. </p>

<p>Here is an example that I normally find when developers are test-driving
a builder implementation.</p>

<p>Now let’s have a look at these tests.  
The good news is, the tests were written in the way developers want to
read them. That also means that they were “designing” the TradeBuilder
public interface (public methods). 
The bad news is how they are testing it.</p>

<p>If you look closer, the tests for the builder are almost identical to
the tests in the TradeTest class. </p>

<p>You may say that it is OK since the builder is creating the object and
the tests should be similar. The only different is that in the TradeTest
we instantiate the object by hand and in the TradeBuilderTest we use the
builder to instantiate it, but the assertions should be the same,
right? </p>

<p>For me, firstly we have duplication. Secondly, the TradeBuilderTest
doesn’t show it’s real intent. </p>

<p>After many refactorings and exploring different ideas, while
pair-programming with one of the guys in my team we came up with this
approach:</p>

<p>So now, the TradeBuilderTest express what is expected from the
TradeBuilder, that means, the side effect when the build method is
called. We want it to create a Trade and set its attributes. There are
no duplications with the TradeTest. It is left to the TradeTest to
guarantee the correct behavior of the Trade object.</p>

<p>For completion’s sake, here is the final TradeBuider class:</p>

<p>The combination of <a href="http://code.google.com/p/mockito/">Mockito</a> and
<a href="http://code.google.com/p/hamcrest/">Hamcrest</a> is extremely powerful,
allowing us to write better and more readable tests.</p>


        
    </div>
    <!--End Blog Post-->
</div>
<!-- End Left Sidebar -->

<!-- Right Sidebar -->
<div class="col-md-3 magazine-page">
    <!-- Blog Latest Tweets -->
    <div class="blog-twitter margin-bottom-30">
        <a class="twitter-timeline" href="https://twitter.com/mashooq/codurance" data-widget-id="400789734676385792">Tweets from Codurance team</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<script>window.twttr = (function(d, s, id) {var js, fjs = d.getElementsByTagName(s)[0],t = window.twttr || {};if (d.getElementById(id)) return t;js = d.createElement(s);js.id = id;js.src = "https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, "script", "twitter-wjs"));</script>
    </div>
    <!-- End Blog Latest Tweets -->
</div>
<!-- End Right Sidebar -->
</div>
<!--/row-->
</div>
<!--/container-->


<!--=== Copyright ===-->
<div class="footer-default">
    <div class="copyright">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <p class="copyright-space">
                         Company Registration No: 8712584
                         | Contact us: <a href="mailto:hello@codurance.com" class="">hello@codurance.com</a>
                         | Phone: +44 203 440 4015
                    </p>

                </div>
                <div class="col-md-4">
                    <ul class="social-icons pull-right">
                        <li><a href="/atom.xml" data-original-title="Feed" class="social_rss"></a></li>
                        <li><a href="http://twitter.com/codurance" data-original-title="Twitter" class="social_twitter"></a></li>
                    </ul>
                </div>
            </div> <!--/row-->
        </div> <!--/container-->
    </div><!--/copyright-->
</div>

<!--=== End Copyright ===-->
</div>

<!-- JS Global Compulsory -->
<script type="text/javascript" src="/assets/plugins/jquery/jquery.min.js"></script>
<script type="text/javascript" src="/assets/plugins/jquery/jquery-migrate.min.js"></script>
<script type="text/javascript" src="/assets/plugins/bootstrap/js/bootstrap.min.js"></script>
<script type="text/javascript" src="/assets/plugins/back-to-top.js"></script>
<!-- JS Implementing Plugins -->
<script type="text/javascript" src="/assets/plugins/owl-carousel/owl-carousel/owl.carousel.js"></script>
<script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=true"></script>
<script type="text/javascript" src="/assets/plugins/gmap/gmap.js"></script>
<!-- JS Customization -->
<script type="text/javascript" src="/assets/js/custom.js"></script>
<!-- JS Page Level -->
<script type="text/javascript" src="/assets/js/app.js"></script>
<script type="text/javascript" src="/assets/js/pages/index.js"></script>

<script type="text/javascript">
    jQuery(document).ready(function() {
        App.init();
        Index.initOwlCarousel();
        Contact.initMap();
    });
</script>
<!--[if lt IE 9]>
    <script src="/assets/plugins/respond.js"></script>
    <script src="/assets/plugins/html5shiv.js"></script> 
    <script src="/assets/js/plugins/placeholder-IE-fixes.js"></script>   
<![endif]-->

</body>
</html>
